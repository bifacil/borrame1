<!DOCTYPE html []>
<html lang="es" data-authenticationTime="0 ms" data-authorizeRequestTime="1 ms" data-engineCreationTime="0 ms" data-engineVariablesTime="0 ms" data-responseCreationTime="3" data-evaluationTime="10" data-queryTime="0" data-evaluationsCount="182" data-queryCount="1" data-query="crono/cargar-dimensiones-dwh-scd.html">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1,requiresActiveX=true" />
    <title>Cargar las dimensiones de un data warehouse</title>
    <meta name="description" content="Comparativa con ejemplos de la carga de una dimension Tipo 1. Si existe algún registro nuevo, lo añadiremos. Si algún registro ha cambiado, lo actualizaremos. 300 líneas de código pero con buen humor." />
    <meta name="keywords" content="Business Intelligence,datawarehouse,crono,BI,cuadro de mando,Barcelona,España" />
    <meta name="y_key" content="f9df80cf3ef594d6" />
    <meta name="google-site-verification" content="w6gZESf_S3APOXfjzJMrnLIiA9bcWeRPJSTjlB-8Mfg" />
    <meta name="msvalfidate.01" content="401B0C3C6EEDE1AC271C85838378209E" />
    <link href="../resources/images/favicon.png" rel="shortcut icon" />
    <link href="../resources/js/animations/animate.min.css" rel="stylesheet" />
    <link href="../resources/css/fontawesome/font-awesome.min.css" rel="stylesheet" />
    <link href="../resources/css/iconfontcustom/icon-font-custom.css" rel="stylesheet" />
    <link href="../resources/css/bootstrap.min.css" rel="stylesheet" />
    <link href="../resources/css/font-awesome.min.css" rel="stylesheet" />
    <link href="../resources/css/base.css" rel="stylesheet" />
    <link href="../resources/css/style.css" type="text/css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Ubuntu:100,100i,300,300i,400,400i,700" rel="stylesheet" />
    <link href="https://www.businessintelligence.info/rss.xml" rel="alternate" type="application/rss+xml" title="(RSS)" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Roboto&amp;display=swap" rel="stylesheet" />
    <link href="https://www.businessintelligence.info/crono/cargar-dimensiones-dwh-scd.html" rel="canonical" />
    <script src="../resources/js/jquery-2.1.1.min.js"></script>
    <script src="../resources/js/viewport/jquery.viewport.js"></script>
    <script>
      (function() {
        var cx = '001840061174465826245:yxey5gkicrq';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
            '//cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <script src="../resources/js/prettify-full.js" type="text/javascript"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
  </head>
  <body>
    <div id="wrap">
      <header id="header" class="stuck">
        <div class="row">
          <div class="span3">
            <div id="logo">
              <a href="../index.html">
                <img src="../resources/images/Logo-bif-crono.png" alt="" />
              </a>
            </div>
          </div>
          <div class="span9">
            <a href="#" id="mobile-menu-trigger">
              <i class="fa fa-bars"></i>
            </a>
            <nav>
              <ul class="sf-menu fixed" id="menu">
                <li>
                  <a href="../buscar.html">
                    <svg width="25" height="25" viewBox="0 0 13 13">
                      <title>Búsqueda</title>
                      <path d="m4.8495 7.8226c0.82666 0 1.5262-0.29146 2.0985-0.87438 0.57232-0.58292 0.86378-1.2877 0.87438-2.1144 0.010599-0.82666-0.28086-1.5262-0.87438-2.0985-0.59352-0.57232-1.293-0.86378-2.0985-0.87438-0.8055-0.010599-1.5103 0.28086-2.1144 0.87438-0.60414 0.59352-0.8956 1.293-0.87438 2.0985 0.021197 0.8055 0.31266 1.5103 0.87438 2.1144 0.56172 0.60414 1.2665 0.8956 2.1144 0.87438zm4.4695 0.2115 3.681 3.6819-1.259 1.284-3.6817-3.7 0.0019784-0.69479-0.090043-0.098846c-0.87973 0.76087-1.92 1.1413-3.1207 1.1413-1.3553 0-2.5025-0.46363-3.4417-1.3909s-1.4088-2.0686-1.4088-3.4239c0-1.3553 0.4696-2.4966 1.4088-3.4239 0.9392-0.92727 2.0864-1.3969 3.4417-1.4088 1.3553-0.011889 2.4906 0.45771 3.406 1.4088 0.9154 0.95107 1.379 2.0924 1.3909 3.4239 0 1.2126-0.38043 2.2588-1.1413 3.1385l0.098834 0.090049z" />
                    </svg>
                  </a>
                </li>
                <li>
                  <a href="../index.html">Inicio</a>
                </li>
                <li>
                  <a href="../archivo.html">Archivo</a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </header>
      <div class="row" id="banner">
        <div class="span10 banner">
          <a href="https://businessintelligence.es" alt="Business Intelligence">
            <img src="../resources/images/banner1.jpg" />
          </a>
        </div>
      </div>
      <div class="row">
        <main class="span10 post">
          <article>
            <div class="up-title">
              <h1>Cargar las dimensiones de un data warehouse</h1>
              <a class="catlink" href="../categorias.html#crono">Crono</a>
            </div>
            <div class="fecha">jueves, 27 de abril de 2017</div>
            <h2>TL;DR;</h2>
            <p>OK. Pedazo de artículo con 300 líneas de código y más de 1000 palabras que no apetece leer. Te lo resumo para que decidas si continuar: SQL es un lenguaje difícil de escribir, las herramientas ETL tradicionales asi asá, y <a href="https://businessintelligence.es/soporte/introduccion-crono-sql.html">Crono SQL</a> mola.</p>
            <p>Todo argumentado con ejemplos y buen humor. Nada debe tomarse demasiado en serio. :-)</p>
            <p>Sáltale la introducción si ya sabes lo que es una SCD.</p>
            <h2>Introducción</h2>
            <p>En otros artículos he hablado sobre la carga de dimensiones y he explicado que las tablas de dimensión se caracterizan por cambiar su contenido poco a poco. Por ese motivo, se las conoce como "dimensiones lentamente cambiantes" o "dimensiones de variación lenta". En inglés se llaman "slowly changing dimensions" o simplemente SCD.</p>
            <p>Me refiero, concretamente, a estos artículos antiguos:</p>
            <ul>
              <li>
                <a href="https://www.businessintelligence.info/serie-dwh/dimensiones-lentamente-cambiantes-scd.html">Serie DWH: Dimensiones lentamente cambiantes</a>
              </li>
              <li>
                <a href="https://www.businessintelligence.info/definiciones/dimensiones-lentamente-cambiantes-scd.html">Dimensiones lentamente cambiantes (SCD)</a>
              </li>
            </ul>
            <p>De todos modos, estas consideraciones son bastante irrelevantes, ya que todas las dimensiones son lentamente cambiantes, y aunque fuesen "rápidamente cambiantes" se cargarían exactamente igual. Por ese motivo, hablaremos simplemente de la <strong>carga de las dimensiones de un data warehouse</strong>.</p>
            <p>Existen 2 maneras de cargar una dimensión:</p>
            <ul>
              <li>
                <strong>SCD Tipo 1:</strong> Se sobreescriben los cambios</li>
              <li>
                <strong>SCD Tipo 2:</strong> Se guarda la historia de cambios</li>
            </ul>
            <p>En este artículo me referiré solo a la carga de dimensiones Tipo 1, que son las más sencillas. Tal vez otro día hablaré de las de Tipo 2, que mostrará aún mejor el argumento de este artículo.</p>
            <p>Conceptualmente, cargar una dimensión tipo 1 es trivial. Sencillamente queremos sobrescribir los valores del data warehouse con la información vigente en nuestro ERP. Si existe algún registro nuevo, lo añadiremos. Si algún registro ha cambiado, lo  actualizaremos. Eso es todo. Parece trivial. Pero, ¿Lo es? Lamentablemente, no tanto...</p>
            <p>Para mostrarlo, veremos las alternativas que existen para desnormalizar la información de producto de la base de datos <strong>AdventureWorks</strong>. El  modelo de datos es el siguiente:</p>
            <p>
              <img src="https://www.businessintelligence.info/resources/imagenes-bi/scd1-datamodel.png" alt="SCD1 con SSIS" />
            </p>
            <h2>Cargar dimensiones SCD Tipo 1 con SQL</h2>
            <p>La consulta para obtener los campos que necesitamos es muy sencilla. A esta operación se llama "desnormalizar". En esto el lenguaje SQL es muy bueno. La consulta es esta:</p>
            <script src="https://gist.github.com/bifacil/3865b32100107737db5875274dc34a4c.js"></script>
            <p>Sin embargo, cargar estos datos en la tabla <em>DimProducts</em> es absurdamente complejo. Por este motivo, cada programador lo hace distinto. Algunos priorizan el rendimiento, otros valoran la facilidad mantenimiento, otros son más pragmáticos y priorizan terminar el desarrollo <em>as soon as possible</em>. El lenguaje SQL es terrible para esto.</p>
            <p>Lo más sencillo es eliminar la tabla y recargarla cada día. Este seria el código:</p>
            <script src="https://gist.github.com/bifacil/f2d6634d6e8d0d0acc4d13e1573bdbfb.js"></script>
            <p>Este método lo considero muy desaconsejable. Por un lado, obtendría el peor rendimiento, y además impediría mantener la integridad con el resto de tablas (...existen ventas asociadas a estos productos que estamos eliminando),  por lo que se deberían desactivar las claves foráneas o incluso prescindir de ellas totalmente. Tampoco te permitiría mantener la clave subrogada ni mantener campos de auditoría. Por lo tanto, por favor, no lo hagas así.</p>
            <p>Si yo tuviese que escribir el código SQL para cargar la tabla <em>DimProducts</em> probablemente haría un <strong>INSERT</strong> para añadir los registros nuevos y un <strong>UPDATE</strong> para actualizar los cambios.</p>
            <script src="https://gist.github.com/bifacil/486447ffe983f3c10b834b9e4a9ee0ba.js"></script>
            <p>Me gusta este método porque el código no es excesivamente complejo. Sin embargo, el rendimiento no sería óptimo, porque estamos actualizando todos los registros, hayan cambiado sus valores o no. De todos modos, incluso con dimensiones de pocos millones de registros el rendimiento puede ser aceptable (si tenemos buen hardware y no excesivas columnas....).</p>
            <p>Si el rendimiento es un problema, deberemos modificar el código para actualizar solo los registros que han cambiado. Aquí la cosas se empiezan a poner feas. ¿Os he dicho que el lenguaje SQL es ridículamente complejo para esta necesidad taaaaaaan habitual en DWH?</p>
            <p>Este es el código necesario para hacerlo "bien":</p>
            <script src="https://gist.github.com/bifacil/75b51133160b899281517185a08799d3.js"></script>
            <p>También existe la instrucción <strong>MERGE</strong> que te permite realizar el <strong>INSERT</strong> y el <strong>UPDATE</strong> en un solo paso. Así debes escribirlo si quieres hacerlo "bien bien":</p>
            <script src="https://gist.github.com/bifacil/54d0adcbf9ace8cd792fcbb80a4a733e.js"></script>
            <p>Como se observa claramente, la dificultad aparece en el momento de comparar, campo a campo, si algún registro ha cambiado. Es una dificultad solo para el programador, ya que con esta sintaxis el motor de la base de datos está  más feliz que un <em>gínjol</em>. No hay relación entre longitud y complejidad del código y rendimiento. Cualquier motor de base de datos es muy eficiente con este tipo de comparaciones. Es solo trabajo de CPU. Comparar unos y ceros para confirmar que la dimensión apenas ha cambiado desde la carga anterior... Actualizar los cambios, insertar los nuevos, ¡y listos!.</p>
            <p>Si miras una vez más el último código, que consideramos "fetén", entenderás que nadie lo haga así. Nadie. Los programadores -los conozco bien- harán todo tipo de asunciones equivocadas para evitar eso, o se montarán una macro Excel que se lo genere, o harán una metaquery de una query que genera parte del código, o defenderán con razón la necesidad de adquirir una herramienta ETL... (nadie es perfecto)</p>
            <h2>Cargar dimensiones SCD Tipo 1 con herramientas ETL</h2>
            <p>Las herramientas gráficas son a los procesos ETL/DWH lo mismo que el WYSIWYG a la programación de páginas web. Deberás diagramar en un flujo de procesos la lógica de la carga. Tras haberlo intentado con SQL, te convencerán fácilmente de las bondades de este tipo de herramientas:</p>
            <p>
              <img src="https://www.businessintelligence.info/resources/imagenes-bi/scd1-ssis.png" alt="SCD1 con SSIS" />
            </p>
            <p>Debo aclarar que estoy hablando siempre de herramientas ETL destinadas a la construcción de un DWH. Para otras necesidades de integración, las herramientas ETL no son solo fantásticas, sino que son imprescindibles. Sin embargo, para ETL/DWH, mi opinión sobre las herramientas gráficas ETL no es extraordinariamente positiva y, de hecho, hay algunas cosas que sería necesario mejorar. No son siempre tan tan buenas como nos las pintan. Asi es como yo veo el anterior diagrama:</p>
            <p>
              <img src="https://www.businessintelligence.info/resources/imagenes-bi/scd1-ssis-2.png" alt="Opinión sobre SCD1 con SSIS" />
            </p>
            <p>De acuerdo. Se me ha visto el plumero. Soy muy crítico con las herramientas ETL y me cuesta encontrar sus virtudes. Además tengo intereses comerciales. En cualquier caso, en mi defensa, debo decir que las conozco y que opinaba exactamente igual hace 15 años cuando me tocó trabajar con ellas. Pero quiero ser ecuánime y contrarestar mi evidente sesgo. Por eso, queridos lectores, agradeceré si utilizáis los comentarios para completar el artículo con un link a un buen tutorial sobre como cargar dimensiones con SSIS, Kettle, ODI o PowerCenter... No lo hago yo por no parecer tendencioso en la elección. :-)</p>
            <p>Tal vez, las herramientas ETL facilitan algo el desarrollo y bastante el mantenimiento posterior. Y digo "tal vez" porque conozco proyectos fallidos que me obligan a cuestionarlo.</p>
            <p>Si hace tiempo que utilizas una herramienta ETL, tal vez has olvidado por que empezaste a utilizarlas. Tal vez es algo que te encontraste cuando llegaste y nunca has cuestionado... ¿Por qué usamos herramientas gráficas para programar procesos ETL/DWH? ¡Porque escribir SQL eficiente es difícil, farragoso, aburrido y propenso a errores! ¡Y porque el mantenimiento de un proyecto complejo porgramado en SQL es básicamente imposible! ¿Las seguirías utilizando si el SQL no tuviera estos defectos? ¿En serio?</p>
            <h2>Cargar dimensiones SCD Tipo 1 con Crono SQL</h2>
            <p>
              <img src="https://www.businessintelligence.info/resources/imagenes-bi/crono-sql-con-superpoderes.jpg" alt="SQL Con superpoderes" />
            </p>
            <p>Se hace así:</p>
            <script src="https://gist.github.com/bifacil/c9f418785c2815dfafc237b6ed7a0dd9.js"></script>
            <div class="viewSql">
              <button type="button" class="btn btn-primary btn-xs" data-toggle="modal" data-target="#modal91a030d61514868b91eb22ce64f12973">Ver SQL compilado</button>
            </div>
            <div class="modal fade" id="modal91a030d61514868b91eb22ce64f12973" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
              <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="True">❌</span>
                    </button>
                    <h4 class="modal-title">Código SQL generado</h4>
                  </div>
                  <div class="modal-body"></div>
                  <script src="https://gist.github.com/bifacil/91a030d61514868b91eb22ce64f12973.js"></script>
                </div>
              </div>
            </div>
            <p>Fácil. <a href="https://businessintelligence.es/soporte/introduccion-crono-sql.html">QED</a>.</p>
            <h2>Síguenos</h2>
            <p>Recuerda que podéis apuntaros a nuestra newletter sobre Business Intelligence o seguirnos en redes sociales:</p>
            <ul>
              <li>
                <a href="https://www.businessintelligence.info/subscribe.html">La newsletter de Business Intelligence fácil</a>
              </li>
              <li>
                <a href="https://www.linkedin.com/company/businessintelligence">Linkdin Crono Business Intelligence</a>
              </li>
              <li>
                <a href="https://twitter.com/bifacil">Twitter @bifacil</a>
              </li>
              <li>
                <a href="https://www.facebook.com/CronoBusinessIntelligence/">Facebook Crono Business Intealligence</a>
              </li>
            </ul>
            <p>Gracias por la atención. Gracias por difundir.</p>
            <div class="comentarios">
              <div id="disqus_thread"></div>
              <script>
            		var disqus_config = function () {
            			this.page.url = 'https://www.businessintelligence.info/crono/cargar-dimensiones-dwh-scd.html'
            			this.page.identifier = 'HyKdMqGXXi'
            		};	
            		(function() { 
            			var d = document, s = d.createElement('script');
            			s.src = '//bifacil.disqus.com/embed.js';
            			s.setAttribute('data-timestamp', +new Date());
            			(d.head || d.body).appendChild(s);
            		})();
            	</script>
            </div>
          </article>
        </main>
      </div>
    </div>
    <footer>
      <div class="row">
        <div class="span3">
          <ul>
            <li>
              <a href="../index.html">Inicio</a>
            </li>
            <li>
              <a href="../archivo.html">Archivo</a>
            </li>
            <li>
              <a href="../categorias.html">Categorías</a>
            </li>
            <li>
              <a href="../sobre-el-blog/contacto.html">Contacto</a>
            </li>
            <li>
              <a href="../sobre-el-blog/enlaces.html">Enlaces</a>
            </li>
          </ul>
        </div>
        <div class="span3">
          <div class="rrss-footer">
            <a href="https://www.linkedin.com/company/businessintelligence" target="_blank" class="fa fa-linkedin"></a>
            <a href="http://twitter.com/bifacil" target="_blank" class="fa fa-twitter"></a>
            <a href="https://www.youtube.com/c/BusinessIntelligenceInfo" target="_blank" class="fa fa-youtube"></a>
            <a href="https://www.facebook.com/CronoBusinessIntelligence" target="_blank" class="fa fa-facebook"></a>
          </div>
        </div>
        <div class="span3">
          <section class="newsletter">
            <p>¿Quieres recibir los artículos de este blog por correo electrónico? No te pierdas ni un artículo. Mantente informado sobre lo que ocurre en el mundo del Business Intelligence.</p>
            <div class="divBoton">
              <a href="../subscribe.html">
                <img src="../resources/images/mail_icona.png" />
                <p>¡Síguenos!</p>
              </a>
            </div>
          </section>
        </div>
      </div>
    </footer>
    <script src="../resources/js/scripts.js"></script>
    <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      try {
        var pageTracker = _gat._getTracker("UA-3456231-2");
        pageTracker._trackPageview();
      } catch(err) {}
    </script>
    <script type="text/javascript">prettyPrint();</script>
  </body>
</html>