<!DOCTYPE html []>
<html lang="es" data-authenticationTime="1 ms" data-authorizeRequestTime="1 ms" data-engineCreationTime="3 ms" data-engineVariablesTime="0 ms" data-responseCreationTime="9" data-evaluationTime="8" data-queryTime="1" data-evaluationsCount="145" data-queryCount="1" data-query="definiciones/una-critica-al-lenguaje-sql-reloaded.html">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1,requiresActiveX=true" />
    <title>Una crítica al lenguaje SQL (parte 3)</title>
    <meta name="description" content="En estos artículos, básicamente, criticaba al lenguaje SQL por ser demasiado verboso. Era poco imperativo y el código contenía demasiadas repeticiones y era difícil de escribir. Sirva este recordatorio para continuar la serie." />
    <meta name="keywords" content="Business Intelligence,datawarehouse,crono,BI,cuadro de mando,Barcelona,España" />
    <meta name="y_key" content="f9df80cf3ef594d6" />
    <meta name="google-site-verification" content="w6gZESf_S3APOXfjzJMrnLIiA9bcWeRPJSTjlB-8Mfg" />
    <meta name="msvalfidate.01" content="401B0C3C6EEDE1AC271C85838378209E" />
    <link href="../resources/images/favicon.png" rel="shortcut icon" />
    <link href="../resources/js/animations/animate.min.css" rel="stylesheet" />
    <link href="../resources/css/fontawesome/font-awesome.min.css" rel="stylesheet" />
    <link href="../resources/css/iconfontcustom/icon-font-custom.css" rel="stylesheet" />
    <link href="../resources/css/bootstrap.min.css" rel="stylesheet" />
    <link href="../resources/css/font-awesome.min.css" rel="stylesheet" />
    <link href="../resources/css/base.css" rel="stylesheet" />
    <link href="../resources/css/style.css" type="text/css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Ubuntu:100,100i,300,300i,400,400i,700" rel="stylesheet" />
    <link href="https://www.businessintelligence.info/rss.xml" rel="alternate" type="application/rss+xml" title="(RSS)" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Roboto&amp;display=swap" rel="stylesheet" />
    <link href="https://www.businessintelligence.info/definiciones/una-critica-al-lenguaje-sql-reloaded.html" rel="canonical" />
    <script src="../resources/js/jquery-2.1.1.min.js"></script>
    <script src="../resources/js/viewport/jquery.viewport.js"></script>
    <script>
      (function() {
        var cx = '001840061174465826245:yxey5gkicrq';
        var gcse = document.createElement('script');
        gcse.type = 'text/javascript';
        gcse.async = true;
        gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
            '//cse.google.com/cse.js?cx=' + cx;
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(gcse, s);
      })();
    </script>
    <script src="../resources/js/prettify-full.js" type="text/javascript"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
  </head>
  <body>
    <div id="wrap">
      <header id="header" class="stuck">
        <div class="row">
          <div class="span3">
            <div id="logo">
              <a href="../index.html">
                <img src="../resources/images/Logo-bif-crono.png" alt="" />
              </a>
            </div>
          </div>
          <div class="span9">
            <a href="#" id="mobile-menu-trigger">
              <i class="fa fa-bars"></i>
            </a>
            <nav>
              <ul class="sf-menu fixed" id="menu">
                <li>
                  <div class="buscador_google">
                    <div class="gcse-search"></div>
                  </div>
                </li>
                <li>
                  <a href="../index.html">Inicio</a>
                </li>
                <li>
                  <a href="../archivo.html">Archivo</a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </header>
      <div class="row" id="banner">
        <div class="span10 banner">
          <a href="https://businessintelligence.es" alt="Business Intelligence">
            <img src="../resources/images/banner1.jpg" />
          </a>
        </div>
      </div>
      <div class="row">
        <main class="span10 post">
          <article>
            <div class="up-title">
              <h1>Una crítica al lenguaje SQL (parte 3)</h1>
              <a class="catlink" href="../categorias.html#definiciones">Definiciones</a>
            </div>
            <div class="fecha">jueves, 13 de abril de 2017</div>
            <p>
              <img src="https://www.businessintelligence.info/resources/imagenes-bi/kitten-meme.png" alt="Cada vez que repites código, Dios mata un gatito" title="Cada vez que repites código, Dios mata un gatito" />
            </p>
            <p>Hace 4 años escribí el segundo artículo de una serie, y lo hice prometiendo que próximamente finalizaría esa reflexión crítica sobre el lenguaje <strong>SQL</strong>. Nunca lo hice. Me estoy refiriendo concretamente a estos dos artículos imprescindibles:</p>
            <ul>
              <li>
                <a href="https://www.businessintelligence.info/definiciones/una-critica-al-lenguaje-sql.html">Cada vez que repites código Dios mata un gatito (parte 1)</a>
              </li>
              <li>
                <a href="https://www.businessintelligence.info/definiciones/una-critica-al-lenguaje-sql-ii.html">Una crítica al lenguaje SQL (parte 2)</a>
              </li>
            </ul>
            <p>En estos artículos, básicamente, criticaba al lenguaje <strong>SQL</strong> por ser demasiado "verboso". Era poco "imperativo" y el código contenía demasiadas repeticiones y era difícil de escribir. Para justificar esas afirmaciones ponía los siguientes 5 ejemplos, que repito solo por completar la infromación (y por supuesto <strong>no es necesario</strong> que analicéis ahora...):</p>
            <pre class="prettyprint lang-sql">
              <code>
-- Ejemplo 1
SELECT
  DimProduct.EnglishProductName AS Producto,
  sum(sales.OrderQuantity) AS Unidades,
  sum(sales.SalesAmount) AS Importe,
  sum(sales.SalesAmount)/sum(sales.OrderQuantity) AS [Precio Medio]
FROM FactResellerSales sales
INNER JOIN DimProduct ON (sales.ProductKey=DimProduct.ProductKey)
INNER JOIN DimProductSubCategory ON (DimProduct.ProductSubcategoryKey=DimProductSubCategory.ProductSubcategoryKey)
INNER JOIN DimProductCategory ON (DimProductSubCategory.ProductCategoryKey=DimProductCategory.ProductCategoryKey)
INNER JOIN DimDate ON (sales.OrderDateKey=DimDate.DateKey)
WHERE
  DimProductCategory.SpanishProductCategoryName='Bicicleta'
  AND DimDate.SpanishMonthName='Enero'
  AND DimDate.CalendarYear=2008
GROUP BY DimProduct.EnglishProductName
ORDER BY sum(sales.SalesAmount)/sum(sales.OrderQuantity) DESC

-- Ejemplo 2
SELECT
  DimProduct.EnglishProductName AS EnglishProductName,
  sum(sales.OrderQuantity) AS Unidades
FROM FactResellerSales sales
INNER JOIN DimReseller ON (sales.ResellerKey=DimReseller.ResellerKey)
INNER JOIN DimGeography ON (DimReseller.GeographyKey=DimGeography.GeographyKey)
INNER JOIN DimProduct ON (sales.ProductKey=DimProduct.ProductKey)
INNER JOIN DimProductSubCategory ON (DimProduct.ProductSubcategoryKey=DimProductSubCategory.ProductSubcategoryKey)
INNER JOIN DimProductCategory ON (DimProductSubCategory.ProductCategoryKey=DimProductCategory.ProductCategoryKey)
INNER JOIN DimDate ON (sales.OrderDateKey=DimDate.DateKey)
WHERE
  DimGeography.SpanishCountryRegionName='Alemania'
  AND DimProductCategory.SpanishProductCategoryName='Bicicleta'
  AND DimDate.CalendarYear=2008
GROUP BY DimProduct.EnglishProductName

--Ejemplo 3
SELECT
  DimGeography.SpanishCountryRegionName AS SpanishCountryRegionName,
  sum(sales.OrderQuantity) AS Unidades
FROM FactResellerSales sales
INNER JOIN DimReseller ON (sales.ResellerKey=DimReseller.ResellerKey)
INNER JOIN DimGeography ON (DimReseller.GeographyKey=DimGeography.GeographyKey)
INNER JOIN DimDate ON (sales.OrderDateKey=DimDate.DateKey)
WHERE DimDate.CalendarYear=2008
GROUP BY DimGeography.SpanishCountryRegionName

-- Ejemplo 4
WITH
sales1 AS (
  SELECT
    DimProduct.EnglishProductName AS EnglishProductName,
    sum(sales.OrderQuantity) AS auxcol_2_
  FROM FactResellerSales sales
  INNER JOIN DimProduct ON (sales.ProductKey=DimProduct.ProductKey)
  INNER JOIN DimProductSubCategory ON (DimProduct.ProductSubcategoryKey=DimProductSubCategory.ProductSubcategoryKey)
  INNER JOIN DimProductCategory ON (DimProductSubCategory.ProductCategoryKey=DimProductCategory.ProductCategoryKey)
  INNER JOIN DimDate ON (sales.OrderDateKey=DimDate.DateKey)
  WHERE
    DimDate.CalendarYear=2007
    AND DimProductCategory.SpanishProductCategoryName='Bicicleta'
    AND DimDate.SpanishMonthName='Enero'
  GROUP BY DimProduct.EnglishProductName
),
sales2 AS (
  SELECT
    DimProduct.EnglishProductName AS EnglishProductName,
    sum(sales.OrderQuantity) AS auxcol_3_
  FROM FactResellerSales sales
  INNER JOIN DimProduct ON (sales.ProductKey=DimProduct.ProductKey)
  INNER JOIN DimProductSubCategory ON (DimProduct.ProductSubcategoryKey=DimProductSubCategory.ProductSubcategoryKey)
  INNER JOIN DimProductCategory ON (DimProductSubCategory.ProductCategoryKey=DimProductCategory.ProductCategoryKey)
  INNER JOIN DimDate ON (sales.OrderDateKey=DimDate.DateKey)
  WHERE
    DimDate.CalendarYear=2008
    AND DimProductCategory.SpanishProductCategoryName='Bicicleta'
    AND DimDate.SpanishMonthName='Enero'
  GROUP BY DimProduct.EnglishProductName
),
COMUN AS (
  SELECT DISTINCT EnglishProductName FROM sales1
  UNION SELECT DISTINCT EnglishProductName FROM sales2
)
SELECT
  COMUN.EnglishProductName,
  sales1.auxcol_2_ AS [Ventas Enero 2007],
  sales2.auxcol_3_ AS [Ventas Enero 2008]
FROM COMUN
LEFT JOIN sales1 ON COMUN.EnglishProductName=sales1.EnglishProductName
LEFT JOIN sales2 ON COMUN.EnglishProductName=sales2.EnglishProductName

-- Ejemplo 5
WITH
isales1 AS (
  SELECT
    DimDate.CalendarYear AS CalendarYear,
    sum(isales.SalesAmount) AS ventasInternet
  FROM FactInternetSales isales
  INNER JOIN DimDate ON (isales.OrderDateKey=DimDate.DateKey)
  INNER JOIN DimCustomer ON (isales.CustomerKey=DimCustomer.CustomerKey)
  INNER JOIN DimGeography ON (DimCustomer.GeographyKey=DimGeography.GeographyKey)
  WHERE DimGeography.SpanishCountryRegionName='Francia'
  GROUP BY DimDate.CalendarYear
),
sales1 AS (
  SELECT
    DimDate.CalendarYear AS CalendarYear,
    sum(sales.SalesAmount) AS ventasReseller
  FROM FactResellerSales sales
  INNER JOIN DimReseller ON (sales.ResellerKey=DimReseller.ResellerKey)
  INNER JOIN DimGeography ON (DimReseller.GeographyKey=DimGeography.GeographyKey)
  INNER JOIN DimDate ON (sales.OrderDateKey=DimDate.DateKey)
  WHERE DimGeography.SpanishCountryRegionName='Francia'
  GROUP BY DimDate.CalendarYear
),
COMUN AS (
  SELECT DISTINCT CalendarYear FROM isales1
  UNION SELECT DISTINCT CalendarYear FROM sales1
)
SELECT
  COMUN.CalendarYear,
  isales1.ventasInternet AS ventasInternet,
  sales1.ventasReseller AS ventasReseller,
  coalesce(sales1.ventasReseller,0)+coalesce(isales1.ventasInternet,0) AS ventas
FROM COMUN
LEFT JOIN isales1 ON COMUN.CalendarYear=isales1.CalendarYear
LEFT JOIN sales1 ON COMUN.CalendarYear=sales1.CalendarYear
</code>
            </pre>
            <p>En definitiva, apuntaba a estas deficiencias del lenguaje:</p>
            <ol>
              <li>Repetición de las mismas fórmulas en las distintas cláusulas de la sentencia</li>
              <li>La insensatez  de las cláusulas <strong>GROUP BY</strong>. ¿En qué estarían pensando los creadores del lenguaje cuando decidieron crear la cláusula <strong>GROUP BY</strong>?</li>
              <li>Repetición de los <strong>JOIN</strong> en las distintas sentencias</li>
              <li>Dificultad de realizar operaciones entre filas</li>
              <li>Dificultad de realizar operaciones entre tablas de hecho</li>
            </ol>
            <p>Si releéis los comentarios de entonces, veréis que algunos me daban la razón, mientras otros decían que ellos escribirían las <strong>SQL</strong> de otro modo. Algunos proponían utilizar vistas, o procedimientos, otros no lo aclararon... Son comentarios interesantes, también.</p>
            <p>No quiero alargarme por no repetirme (DRY...). Lo que quería exponer en su momento creo que está claramente expresado en las <a href="https://www.businessintelligence.info/definiciones/una-critica-al-lenguaje-sql.html">parte 1</a> y <a href="https://www.businessintelligence.info/definiciones/una-critica-al-lenguaje-sql-ii.html">parte 2</a> de esta serie. Hoy sigo manteniendo la misma opinión, y aunque dejase la serie colgada, no me olvidé de esos artículos ni de este "temita" del <strong>SQL</strong>. De hecho, no he dejado de pensar en ello desde entonces...</p>
            <p>Sirva este recordatorio para continuar la serie. Y avanzo que el <strong>próximo martes</strong> publicaré un <a href="https://www.businessintelligence.info/crono/presentacion-crono-sql.html">nuevo artículo con la solución a todos los problemas planteados</a>. Y un GRAN ANUNCIO.</p>
            <p>KEEP TUNED.</p>
            <div class="comentarios">
              <div id="disqus_thread"></div>
              <script>
            		var disqus_config = function () {
            			this.page.url = 'https://www.businessintelligence.info/definiciones/una-critica-al-lenguaje-sql-reloaded.html'
            			this.page.identifier = 'iAWqKQAIml'
            		};	
            		(function() { 
            			var d = document, s = d.createElement('script');
            			s.src = '//bifacil.disqus.com/embed.js';
            			s.setAttribute('data-timestamp', +new Date());
            			(d.head || d.body).appendChild(s);
            		})();
            	</script>
            </div>
          </article>
        </main>
      </div>
    </div>
    <footer>
      <div class="row">
        <div class="span3">
          <ul>
            <li>
              <a href="../index.html">Inicio</a>
            </li>
            <li>
              <a href="../archivo.html">Archivo</a>
            </li>
            <li>
              <a href="../categorias.html">Categorías</a>
            </li>
            <li>
              <a href="../sobre-el-blog/contacto.html">Contacto</a>
            </li>
            <li>
              <a href="../sobre-el-blog/enlaces.html">Enlaces</a>
            </li>
          </ul>
        </div>
        <div class="span3">
          <div class="rrss-footer">
            <a href="https://www.linkedin.com/company/businessintelligence" target="_blank" class="fa fa-linkedin"></a>
            <a href="http://twitter.com/bifacil" target="_blank" class="fa fa-twitter"></a>
            <a href="https://www.youtube.com/c/BusinessIntelligenceInfo" target="_blank" class="fa fa-youtube"></a>
            <a href="https://www.facebook.com/CronoBusinessIntelligence" target="_blank" class="fa fa-facebook"></a>
          </div>
        </div>
        <div class="span3">
          <section class="newsletter">
            <p>¿Quieres recibir los artículos de este blog por correo electrónico? No te pierdas ni un artículo. Mantente informado sobre lo que ocurre en el mundo del Business Intelligence. 
<a href="../subscribe.html">¡Síguenos!</a></p>
          </section>
        </div>
      </div>
    </footer>
    <script src="../resources/js/scripts.js"></script>
    <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      try {
        var pageTracker = _gat._getTracker("UA-3456231-2");
        pageTracker._trackPageview();
      } catch(err) {}
    </script>
    <script type="text/javascript">prettyPrint();</script>
  </body>
</html>